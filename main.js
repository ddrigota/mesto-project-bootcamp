(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{M:()=>J,E:()=>Q});var e=document.querySelector(".profile__text"),o=e.querySelector(".profile__name"),n=e.querySelector(".profile__bio"),r=document.querySelector(".profile__edit-button"),c=document.querySelector("#popup-edit"),i=document.querySelector(".profile__avatar"),s=document.querySelector(".profile__avatar-edit-button"),a=document.querySelector("#popup-edit-avatar"),u=document.forms.userinfo,l=u.elements.username,d=u.elements.bio,f=document.forms.avatar,p=f.elements.avatar,m=document.querySelector(".profile__add-button"),_=document.querySelector("#popup-add"),v=document.forms.newpost,h=v.elements.caption,y=v.elements.link,b=document.querySelector("#popup-delete-confirmation"),S=document.querySelector(".posts-grid__list"),k=document.querySelector("#post-template").content,g=document.querySelector("#popup-image-preview"),E=g.querySelector(".popup__image"),L=g.querySelector(".popup__image-description");function q(t){var e=document.querySelector(".popup_opened");(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&x(e)}function C(t){"Escape"===t.key&&x(document.querySelector(".popup_opened"))}function j(t){t.classList.add("popup_opened"),document.addEventListener("keydown",C),document.addEventListener("click",q)}function x(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",C),document.removeEventListener("click",q)}function P(t,e){e.querySelector(".form__submit-button").textContent=t?"Сохранение...":"Сохранить"}var A="ee0956cc-88d8-4912-8bbc-58b6d84714ec",T="https://nomoreparties.co/v1/wbf-cohort-15",z="86f8732160a3d589d063f4ea";function w(t){o.textContent=t.name,n.textContent=t.about,i.src=t.avatar}function B(t){var e=k.querySelector(".posts-grid__list-item").cloneNode(!0),o=e.querySelector(".post__image"),n=e.querySelector(".post__text"),r=e.querySelector(".post__like-counter");return o.src=t.link,o.alt=t.name,n.textContent=t.name,r.textContent=t.likes.length,e.id=t._id,t.likes.some((function(t){return t._id===z}))&&e.querySelector(".post__like-button").classList.add("post__like-button_liked"),e.addEventListener("click",O),e}function O(t){var e,o=t.target.closest(".posts-grid__list-item").id;if(t.target.classList.contains("post__like-button")&&!t.target.classList.contains("post__like-button_liked"))!function(t,e){t.target.classList.add("post__like-button_liked"),function(t){return fetch("".concat(T,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:A}}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}))}(e).then((function(t){document.getElementById(e).querySelector(".post__like-counter").textContent=t.likes.length})).catch((function(t){console.log(t)}))}(t,o);else if(t.target.classList.contains("post__like-button")&&t.target.classList.contains("post__like-button_liked"))!function(t,e){t.target.classList.remove("post__like-button_liked"),function(t){return fetch("".concat(T,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:A}}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}))}(e).then((function(t){document.getElementById(e).querySelector(".post__like-counter").textContent=t.likes.length})).catch((function(t){console.log(t)}))}(t,o);else if(t.target.classList.contains("post__delete-button"))e=o,j(b),b.addEventListener("submit",(function(t){t.preventDefault(),function(t){return fetch("".concat(T,"/cards/").concat(t),{method:"DELETE",headers:{authorization:A}}).then((function(t){if(!t.ok)return Promise.reject("Error: ".concat(t.status))}))}(e).then((function(){document.getElementById(e).remove(),x(b)})).catch((function(t){console.log(t)}))}));else if(t.target.classList.contains("post__image")){var n=t.target,r=n.closest(".posts-grid__list-item").querySelector(".post__text").textContent;E.src=n.src,E.alt=r,L.textContent=r,j(g)}}function D(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o),r.classList.remove(n),r.textContent=""}function N(t,e){t.classList.add(e),t.setAttribute("disabled",!0)}function I(t,e,o){t.checkValidity()?(e.classList.remove(o),e.removeAttribute("disabled")):N(e,o)}function J(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){D(t,o,e.inputErrorClass,e.errorClass)}))}var H,M,U,V,F,G,K,Q={formSelector:".form",inputSelector:".form__text-input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__text-input_error",errorClass:"form__error-message_visible"};fetch("".concat(T,"/users/me"),{headers:{authorization:A}}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))})).then((function(t){w(t)})).catch((function(t){console.log(t)})),fetch("".concat(T,"/cards"),{headers:{authorization:A}}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))})).then((function(t){t.forEach((function(t){var e=B(t);S.append(e),t.owner._id===z&&e.querySelector(".post__delete-button").classList.add("post__delete-button_visible")}))})),r.addEventListener("click",(function(){j(c),J(c,Q),l.value=o.textContent,d.value=n.textContent})),m.addEventListener("click",(function(){j(_)})),s.addEventListener("click",(function(){j(a),J(a,Q)})),M=(H=Q).formSelector,U=H.inputSelector,V=H.submitButtonSelector,F=H.inactiveButtonClass,G=H.inputErrorClass,K=H.errorClass,Array.from(document.querySelectorAll(M)).forEach((function(t){!function(t,e,o,n,r,c){var i=Array.from(t.querySelectorAll(e)),s=t.querySelector(o);I(t,s,n),t.addEventListener("reset",(function(){return N(s,n)})),i.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,o,n){e.validity.valid?D(t,e,o,n):function(t,e,o,n,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),c.classList.add(r),c.textContent=o}(t,e,e.validationMessage,o,n)}(t,e,r,c),I(t,s,n)}))}))}(t,U,V,F,G,K)})),v.addEventListener("submit",(function(t){var e,o;t.preventDefault(),P(!0,_),(e=h.value,o=y.value,fetch("".concat(T,"/cards"),{method:"POST",headers:{authorization:A,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:o})}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}))).then((function(t){var e=B(t);S.prepend(e)})).catch((function(t){console.log(t)})).finally((function(){P(!1,_),x(_),t.target.reset()}))})),u.addEventListener("submit",(function(t){var e,o;t.preventDefault(),P(!0,c),(e=l.value,o=d.value,fetch("".concat(T,"/users/me"),{method:"PATCH",headers:{authorization:A,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}))).then((function(t){w(t)})).catch((function(t){console.log(t)})).finally((function(){P(!1,c)})),x(c)})),f.addEventListener("submit",(function(t){var e;t.preventDefault(),P(!0,a),(e=p.value,fetch("".concat(T,"/users/me/avatar"),{method:"PATCH",headers:{authorization:A,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))}))).then((function(t){w(t)})).catch((function(t){console.log(t)})).finally((function(){P(!1,a)})),x(a)}))})();